<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Painel Administrativo</title>

    <style>
        * {
        box-sizing: border-box;
        font-family: "Nunito Sans", sans-serif;
        margin: 0;
        padding: 0;
        }
        body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background-color: #f2f8fc;
        }
        .header {
        background-color: #333;
        color: #f2f8fc;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        }
        .header h1 {
        font-size: 24px;
        }
        .adicionar-video-botao {
        background-color: #164599;
        color: #f2f8fc;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        border-radius: 4px;
        font-size: 14px;
        }
        .adicionar-video-botao:hover {
        background-color: #164699d5;
        }
        table {
        width: 90%;
        margin: 30px auto;
        border-collapse: collapse;
        background-color: #f2f8fc;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        font-size: 14px;
        overflow-x: auto;
        }
        table thead th {
        background-color: #f2f8fc;
        color: #333;
        font-weight: 600;
        padding: 12px 15px;
        text-align: left;
        border-bottom: 2px solid #f2f8fc;
        }
        table tbody td {
        padding: 12px 15px;
        color: #555;
        border-bottom: 1px solid #eee;
        }
        table tbody tr:nth-child(odd) {
        background-color: #f2f8fc;
        }
        table tbody tr:nth-child(even) {
        background-color: #f2f8fc;
        }
        table tbody tr:hover {
        background-color: #f2f8fc;
        cursor: pointer;
        }
        .acao {
        text-align: right;
        }
        .botaoEditar {
        background-color: #3d95dd;
        color: #f2f8fc;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 13px;
        margin-right: 8px;
        transition: background-color 0.2s;
        }
        .botaoEditar:hover {
        background-color: #1976d2;
        }
        .botaoEliminar {
        background-color: #e74c3c;
        color: #f2f8fc;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 13px;
        transition: background-color 0.2s;
        }
        .botaoEliminar:hover {
        background-color: #c0392b;
        }
        @media (max-width: 600px) {
        table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
        table thead, table tbody, table th, table td, table tr {
            display: block;
        }
        table thead tr {
            background-color: #f2f8fc;
        }
        table thead th {
            width: 150px;
            display: inline-block;
        }
        table tbody tr {
            margin-bottom: 10px;
        }
        table tbody td {
            display: inline-block;
            width: 150px;
        }
        }

        
        .inputPopup {
        display: flex;               /* começa escondido */
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;               /* fica acima do conteúdo */
        justify-content: center;
        align-items: center;
        }

        .icon-close {
        position: absolute;
        top: 12px;
        right: 12px;
        font-size: 24px;
        color: #555;
        cursor: pointer;
        transition: color 0.2s;
        }

        .icon-close:hover {
        color: #000;
        }

        /* A caixa do formulário em si */
        .form-boxupload {
        background-color: #f2f8fc;
        padding: 20px 30px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        width: 90%;
        max-width: 500px;
        position: relative;
        }

        /* Título do modal */
        .form-boxupload h2 {
        margin-bottom: 15px;
        color: #333;
        font-size: 20px;
        }

        /* Estilo para cada label + input */
        .form-boxupload label {
        display: block;
        margin-top: 10px;
        font-weight: 500;
        color: #333;
        font-size: 14px;
        }
        .form-boxupload input[type="text"],
        .form-boxupload input[type="url"] {
        width: 100%;
        padding: 10px 12px;
        margin-top: 5px;
        border: 1px solid #2d313451;
        border-radius: 4px;
        font-size: 14px;
        }

        /* Container dos botões no modal */
        /* .modal-buttons {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
        } */

        /* Botão “Upload” dentro do modal */
        .botaoUpload {
        background-color: #4caf50;
        color: #f2f8fc;
        border: none;
        padding: 10px 18px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        }
        .botaoUpload:hover {
        background-color: #45a049;
        }

        /* Botão “Cancelar” dentro do modal */
        /* .btn-cancel {
        background-color: #bbb;
        color: #fff;
        border: none;
        padding: 10px 18px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
        transition: background-color 0.2s;
        }
        .btn-cancel:hover {
        background-color: #999;
        } */
    </style>
</head>
<body>
    <div class="header">
        <div class="videos">
            <h1>Gestao de videos</h1>
            <!-- <button class="adicionar-video-botao" onclick="mostrarPopup()"> Adicionar Video </button> -->
            
        </div>
        
    <div>
    <table>
      <thead>
        <tr>
          <th>Titulo</th>
          <th>Descricao</th>
          <th>Duracao</th>
          <th>Acoes</th>
        </tr>
      </thead>
      <tbody id="listaVideos"></tbody>
    </table>
    </div>
    
    <div id = "uploadPopup" class="inputPopup">
        
        
        <div class="form-boxupload">
            <span class="icon-close" onclick="noPopup()"><ion-icon name="close"></ion-icon></span>
            <form id="uploadForm">
            
            <h2>upload</h2>
            
            <div class="input-box">
                
                <label>Titulo de Video: </label>
                <input type="text" id="inputTitulo" required>
            </div>
            
            <div class="input-box">
                
                <input type="text" id = "inputDescricao"required>
                <label>descricao</label>
            </div>

            <div class="input-box">
                <label class="inputmp4">Video (MP4)</label>
                <input type="file" id="inputFile" accept="video/mp4" required>
            </div>

            <button class="botaoUpload" onclick="adicionarVideo(event)">upload</button>
            </form>
            <div id="messageupload"></div>
        </div>
    </div>


    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script>

        // const wrapper = document.querySelector('.wrapper');
        // const loginlink = document.querySelector('.login-link');
        // const buttonpopup = document.querySelector('.loginbutton');
        // const iconclose = document.querySelector('.icon-close');

        // loginlink.addEventListener('click', ()=>{
        //     wrapper.classList.remove('active');
        // });

        // buttonpopup.addEventListener('click', ()=>{
        //     wrapper.classList.add('active-popup');
        // });

        // iconclose.addEventListener('click', ()=>{
        //     wrapper.classList.remove('active-popup');
        // });
        // async function obterVideos(){
        //     const videosFetch = await fetch('http://127.0.0.1:5000/api/video', {method: 'GET', headers: {'Content-Type': 'application/json'}});
        //     if (!videosFetch.ok) {
        //         console.error('Falha ao obter vídeos. Status:', resposta.status);
        //         return;
        //     }
            
        //     const videos = await videosFetch.json();
        //     const listarVideos = document.getElementById("listaVideos");
        //     listarVideos.innerHTML ="";
            
        //     videos.forEach(video => {
        //         const linha = document.createElement("tr");
        //         linha.innerHTML= `
        //             <td>${video.titulo}</td>
        //             <td>${video.descricao}</td>
        //             <td>${video.duracao}</td>
        //             <td class = "acao">
        //                 <button class="botaoEditar" onClick="editarVideo("${video._id}", ${JSON.stringify(video)})">Editar</button>
        //                 <button class="botaoEliminar" onClick="eliminarVideo("${video._id}")">Eliminar</button> 
        //             </td>
        //         `;
        //         tbody.appendChild(linha);     
        //     });
        // }

        // obterVideos();

        // function obterVideos() {
        //     try {
                
        //         const resposta = fetch('http://127.0.0.1:5000/api/video', {
        //         method: 'GET',
        //         headers: { 'Content-Type': 'application/json' }
        //         });
        //         if (!resposta.ok) {
        //         console.error('Falha ao obter vídeos. Status:', resposta.status);
        //         return;
        //         }
        //         const videos = resposta.json();
        //         const listarVideos = document.getElementById("listaVideos");
        //         listarVideos.innerHTML = "";

        //         videos.forEach(video => {
        //         const linha = document.createElement("tr");
        //         linha.innerHTML = `
        //             <td>${video.titulo}</td>
        //             <td>${video.descricao}</td>
        //             <td>${video.duracao}</td>
                    
        //             <td class="acao">
        //                 <button class="botaoEditar" onclick='editarVideo("${video._id}", ${JSON.stringify(video)})'>Editar</button>
        //                 <button class="botaoEliminar" onclick='removerVideo("${video._id}")'>Eliminar</button>
        //             </td>
        //         `;
        //         listarVideos.appendChild(linha);
        //         });
        //     } catch (err) {
        //         console.error('Erro de rede ou JSON parsing:', err);
        //     }
        //     }

            
        //     obterVideos();
        

        // function obterVideos() {
        //     fetch('http://127.0.0.1:5000/api/video', {
        //         method: 'GET'
        //     })
        //     .then(function(response) {
        //         if (!response.ok) {
        //         console.error('Falha ao obter vídeos. Status:', response.status);
        //         // interrompe a cadeia retornando undefined
        //         return;
        //         }
        //         return response.json();
        //     })
        //     .then(function(videos) {
        //         // se o response.ok foi false, vídeos será undefined
        //         if (!videos) return;

        //         const listarVideos = document.getElementById("listaVideos");
        //         listarVideos.innerHTML = "";

        //         videos.forEach(function(video) {
        //         const linha = document.createElement("tr");
        //         linha.innerHTML = `
        //             <td>${video.titulo}</td>
        //             <td>${video.descricao}</td>
        //             <td>${video.duracao}</td>
        //             <td class="acao">
        //             <button class="botaoEditar" onclick='editarVideo("${video._id}", ${JSON.stringify(video)})'>
        //                 Editar
        //             </button>
        //             <button class="botaoEliminar" onclick='removerVideo("${video._id}")'>
        //                 Eliminar
        //             </button>
        //             </td>
        //         `;
        //         listarVideos.appendChild(linha);
        //         });
        //     })
        //     .catch(function(err) {
        //         console.error('Erro de rede ou JSON parsing:', err);
        //     });
        //     }
        function obterVideos() {
            fetch('http://127.0.0.1:5000/api/videos', {
                method: 'GET'
            })
            .then(response => {
                if (!response.ok) {
                console.error('Falha ao obter vídeos. Status:', response.status);
                throw new Error('HTTP ' + response.status);
                }
                return response.json();
            })
            .then(videos => {
                const tbody = document.getElementById('listaVideos');
                tbody.innerHTML = '';

                videos.forEach(video => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>${video.titulo}</td>
                <td>${video.descricao}</td>
                <td>${video.duracao}</td>
                `;
                tbody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Erro ao listar vídeos:', error);
                alert('Não foi possível carregar a lista de vídeos.');
            });
            }
            // chama a função para popular a tabela na carga da página
            obterVideos();


        // function mostrarPopup() {
        //     document.getElementById("uploadPopup").style.display = "flex";
        // }
        // function noPopup() {
        //     document.getElementById("uploadPopup").style.display = "none";
        //     limpaPopup();
        // }
        // function limpaPopup() {
        //     document.getElementById("inputTitulo").value = "";
        //     document.getElementById("inputDescricao").value = "";
        //     document.getElementById("inputFile").value ="";
            
        // }




        // function adicionarVideo() {
        //     const titulo = document.getElementById("inputTitulo").value.trim();
        //     const descricao = document.getElementById("inputDescricao").value.trim();
        //     const video = document.getElementById("inputFile").files[0];
            
        //     if (!titulo || !descricao || !video) {
        //         alert("Todos os campos são obrigatórios!");
        //         return;
        //     }
        //     const formData = new FormData();
        //     formData.append('titulo', titulo);
        //     formData.append('descricao', descricao);
        //     formData.append('videofile', video);
        //     try {
        //         const resposta = fetch('http://127.0.0.1:5000/api/video', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: formData
        //         })
        //         if(!resposta.ok){
        //             console.error("Statos do POST: ", resposta.status);
        //             const erro = resposta.text();
        //             alert("Nao foi possivel adicionar video. ")
        //             return;
        //         }
        //         console.log("Video adicionado")
        //         noPopup();
        //         obterVideos();
        //     } catch (error) {
        //         console.error("Erro ao iniciar fetch de adição:", error);
        //     }
        // }


        
        // function adicionarVideo(event) {
        //     event.preventDefault();

        //     const form = document.getElementById("uploadForm");
        //     //const formData = new FormData(form);
        //     const dados = Object.fromEntries(new FormData(form));
        //     //const messageDiv = document.getElementById("messageupload");

        //     fetch("http://127.0.0.1:5000/api/videos", {
        //         method: "POST",
        //         //headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify(dados)
        //     })
        //     .then(response => {
        //         if (!response.ok) {
        //         return response.json().then(err => {
        //             throw err; // dispara pro .catch
        //         });
        //         }
        //         return response.json();
        //     })
        //     .then(data => {
        //         // data é o JSON de sucesso
        //         //messageDiv.innerHTML = `<p style="color: green;">Upload realizado com sucesso!</p>`;
        //         limpaPopup();
        //         obterVideos();
        //         noPopup();
        //     })
        //     .catch(err => {
        //         // err pode ser a resposta JSON ou um Error de rede
        //         const msg = err.message || JSON.stringify(err);
        //         //messageDiv.innerHTML = `<p style="color: red;">Erro: ${msg}</p>`;
        //         console.error("Erro no upload:", err);
        //     });
        //     }
        function adicionarVideo(event) {
            event.preventDefault(); // Previne o envio padrão do formulário

            const form = document.getElementById("uploadForm");
            const formData = new FormData();
            formData.append('titulo', titulo);
            formData.append('descricao', descricao);
            formData.append('videofile', video);

            fetch("http://127.0.0.1:5000/api/videos", {
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                const messageDiv = document.getElementById("messageupload");
                if (data.status && data.status === "error") {
                    messageDiv.innerHTML = '<p style="color: red;">Erro: ${data.message}</p>';
                } else {
                    messageDiv.innerHTML = '<p style="color: green;">Upload realizado com sucesso!</p>';
                    form.reset(); 
                    // limpaPopup();
                    // noPopup();
                    obterVideos();  
                }
                console.log("Resposta do servidor:", data);
            })
            .catch(error => {
                console.error("Erro:", error);
                const messageDiv = document.getElementById("messageupload");
                messageDiv.innerHTML = '<p style="color: red;">Ocorreu um erro no upload. ${error}.</p>';
            });
        }

        // function editarVideo(id, video){
        //     const titulo = prompt("Novo titulo: ", video.titulo);
        //     const descricao = prompt("Nova descrição:", video.descricao);
        //     // const duracao = prompt("Nova duração:", video.duracao);
        //     // const url = prompt("Novo URL:", video.url);
        //     if(titulo && descricao){
        //         try {
        //                 fetch(`http://127.0.0.1:5000/api/video/${id}`, {
        //                 method: 'PUT',
        //                 headers: { 'Content-Type': 'application/json' },
        //                 body: JSON.stringify({ titulo, descricao})
        //             });
        //             obterVideos();
        //             } catch (error) {
        //             console.error("Erro ao editar vídeo:", error);
        //         }
        //     }
        // }

        function editarVideo(id, dados){
            let titulo = prompt("Novo titulo: ", dados.titulo || "")
            if (titulo === null || titulo.trim() === ""){
                titulo = dados.titulo;

            }
            let descricao = prompt("Nova descricao: ", dados.descricao || "")
            if (descricao === null || descricao.trim() === ""){
                descricao = dados.descricao;
            }

            try{
                const dadosNovos ={
                    titulo: titulo,
                    descricao: descricao,
                    duracao: dados.duracao,
                    url: dados.url
                };
                const resposta = fetch(`http://127.0.0.1:5000/api/videos/${id}`, {
                    method: 'PUT', 
                    headers:{'Content-Type':'application/json'}, 
                    body: JSON.stringify(dadosNovos)});
                if(!resposta.ok){
                    console.error("Falha a editar. Erro:", resposta.status);
                    alert("Não foi possivel editar o video!")
                    return;
                }
                console.log("video editado com sucesso.", resposta.json());
                obterVideos();
            }
            catch (erro) {
                console.error("Erro no PUT /api/videos/:id:", erro);
                alert("Ocorreu um erro ao atualizar o vídeo.");
            }
        }


        function removerVideo(id) {
        if (confirm("Tens a certeza que queres eliminar este vídeo?")) {
            try {
                fetch(`http://127.0.0.1:5000/api/videos/${id}`, { method: 'DELETE' });
                obterVideos();
            } catch (error) {
            console.error("Erro ao eliminar vídeo:", error);
            }
        }
        }

        obterVideos();




    </script>


    



</body>
</html>